{"ast":null,"code":"import{Card,CardBody,CardHeader,CardSubtitle,CardTitle,Col,Input,Row,Table}from'reactstrap';import React,{useEffect,useState}from\"react\";import API_URL from\"../../handler/api\";import{fetchPredictionData}from\"../../handler/sessionStorageHandler\";import ChangeValuesModal from\"../Modals/ChangeValuesModal\";import PredictionChangedModal from\"../Modals/PredictionChangedModal\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function convertToBoolean(boolean){return boolean===1;}function ModelInput(_ref){let{patient}=_ref;const oldPrediction=fetchPredictionData();const[newPrediction,setNewPrediction]=useState({});const[predictionChangedIsOpen,setPredictionChangedIsOpen]=useState(false);const[valueChangedIsOpen,setValueChangedIsOpen]=useState(false);const[modalFeature,setModalFeature]=useState('');const humanBodyFeaturesNieuw={\"Weight\":{\"value\":patient.weight,\"type\":\"number\"},\"Temperature\":{\"value\":patient.temperature,\"type\":\"number\"},\"Heart Rate\":{\"value\":patient.heart_rate,\"type\":\"number\"},\"Respiration Rate\":{\"value\":patient.resp_rate,\"type\":\"number\"},\"Oxygen Saturation\":{\"value\":patient.spo2,\"type\":\"number\"},\"Systolic Blood Pressure\":{\"value\":patient.sbp,\"type\":\"number\"},\"Diastolic Blood Pressure\":{\"value\":patient.dbp,\"type\":\"number\"},\"Mean Blood Pressure\":{\"value\":patient.mbp,\"type\":\"number\"},\"White Blood Cell Count\":{\"value\":patient.wbc,\"type\":\"number\"},\"Hemoglobin\":{\"value\":patient.hemoglobin,\"type\":\"number\"},\"Platelet Count\":{\"value\":patient.platelet,\"type\":\"number\"},\"Blood Urea Nitrogen\":{\"value\":patient.bun,\"type\":\"number\"},\"Creatinine\":{\"value\":patient.cr,\"type\":\"number\"},\"Glucose\":{\"value\":patient.glu,\"type\":\"number\"},\"Sodium\":{\"value\":patient.Na,\"type\":\"number\"},\"Chloride\":{\"value\":patient.Cl,\"type\":\"number\"},\"Potassium\":{\"value\":patient.K,\"type\":\"number\"},\"Magnesium\":{\"value\":patient.Mg,\"type\":\"number\"},\"Calcium\":{\"value\":patient.Ca,\"type\":\"number\"},\"Phosphorus\":{\"value\":patient.P,\"type\":\"number\"},\"International Normalized Ratio\":{\"value\":patient.inr,\"type\":\"number\"},\"Prothrombin Time\":{\"value\":patient.pt,\"type\":\"number\"},\"Partial Thromboplastin Time\":{\"value\":patient.ptt,\"type\":\"number\"},\"Bicarbonate\":{\"value\":patient.bicarbonate,\"type\":\"number\"},\"Anion Gap\":{\"value\":patient.aniongap,\"type\":\"number\"},\"Glasgow Coma Scale\":{\"value\":patient.gcs,\"type\":\"number\"},\"Ventilation\":{\"value\":patient.vent,\"type\":\"number\"},\"Continuous Renal Replacement Therapy\":{\"value\":patient.crrt,\"type\":\"number\"},\"Vasoconstrictors\":{\"value\":patient===null||patient===void 0?void 0:patient.vaso,\"type\":\"number\"},\"Sedatives\":{\"value\":patient===null||patient===void 0?void 0:patient.seda,\"type\":\"number\"},\"Sequential Organ Failure Assessment Score\":{\"value\":patient===null||patient===void 0?void 0:patient.sofa_score,\"type\":\"number\"},\"Acute Myocardial Infarction\":{\"value\":patient===null||patient===void 0?void 0:patient.ami,\"type\":\"number\"},\"Chronic Kidney Disease\":{\"value\":patient===null||patient===void 0?void 0:patient.ckd,\"type\":\"number\"},\"Chronic Obstructive Pulmonary Disease\":{\"value\":patient===null||patient===void 0?void 0:patient.copd,\"type\":\"number\"},\"Hypertension\":{\"value\":patient===null||patient===void 0?void 0:patient.hyperte,\"type\":\"number\"},\"Diabetes Mellitus\":{\"value\":patient===null||patient===void 0?void 0:patient.dm,\"type\":\"number\"},\"Acute Kidney Injury\":{\"value\":patient===null||patient===void 0?void 0:patient.aki,\"type\":\"number\"},\"Stroke\":{\"value\":patient===null||patient===void 0?void 0:patient.stroke,\"type\":\"number\"},\"Aisan\":{\"value\":convertToBoolean(patient===null||patient===void 0?void 0:patient.AISAN),\"type\":\"boolean\"},\"Black\":{\"value\":convertToBoolean(patient.BLACK),\"type\":\"boolean\"},\"Hispanic\":{\"value\":convertToBoolean(patient===null||patient===void 0?void 0:patient.HISPANIC),\"type\":\"boolean\"},\"Other\":{\"value\":convertToBoolean(patient===null||patient===void 0?void 0:patient.OTHER),\"type\":\"boolean\"},\"White\":{\"value\":convertToBoolean(patient===null||patient===void 0?void 0:patient.WHITE),\"type\":\"boolean\"},\"Unknown\":{\"value\":convertToBoolean(patient===null||patient===void 0?void 0:patient.unknown),\"type\":\"boolean\"},\"Coronary Care Unit\":{\"value\":convertToBoolean(patient===null||patient===void 0?void 0:patient.CCU),\"type\":\"boolean\"},\"Cardiovascular Intensive Care Unit\":{\"value\":convertToBoolean(patient===null||patient===void 0?void 0:patient.CVICU),\"type\":\"boolean\"},\"Mobile Intensive Care Unit\":{\"value\":convertToBoolean(patient===null||patient===void 0?void 0:patient.MICU),\"type\":\"boolean\"},\"Mobile/Surgical Intensive Care Unit\":{\"value\":convertToBoolean(patient===null||patient===void 0?void 0:patient.MICU_SICU),\"type\":\"boolean\"},\"Neonatal Intensive Care Unit\":{\"value\":convertToBoolean(patient===null||patient===void 0?void 0:patient.NICU),\"type\":\"boolean\"},\"Surgical Intensive Care Unit\":{\"value\":convertToBoolean(patient===null||patient===void 0?void 0:patient.SICU),\"type\":\"boolean\"},\"Trauma Intensive Care Unit\":{\"value\":convertToBoolean(patient===null||patient===void 0?void 0:patient.TSICU),\"type\":\"boolean\"}};const[updatedFeatures,setUpdatedFeatures]=useState(humanBodyFeaturesNieuw);useEffect(()=>{if(!fetchPredictionData()){setNewPrediction({'prediction':0,'confidence':0});}else{const predictionData=fetchPredictionData();setNewPrediction({'prediction':predictionData['prediction'],'confidence':predictionData['confidence']});}},[]);const inputHandler=event=>{const updatedFeature=event.target.title;switch(typeof updatedFeatures[updatedFeature].value){case\"number\":updatedFeatures[updatedFeature].value=Number(event.target.value);break;case\"string\":updatedFeatures[updatedFeature].value=String(event.target.value);break;//TODO: Dropdown voor Units en Etniciteit maken.\ncase\"boolean\":if(event.target.value.toString().toLowerCase()===\"true\"){updatedFeatures[updatedFeature].value=true;break;}if(event.target.value.toString().toLowerCase()===\"false\"){updatedFeatures[updatedFeature].value=false;break;}break;default:updatedFeatures[updatedFeature].value=String(event.target.value);break;}};const translatePrediction=prediction=>{if(Number(prediction)<0.5){return\"Nee\";}else if(Number(prediction)>=0.5){return\"Ja\";}else{return\"Unknown\";}};const predictionHandler=async()=>{setValueChangedIsOpen(false);const response=await fetch(API_URL+\"predict\",{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({\"age\":patient.age,\"weight\":updatedFeatures['Weight'].value,\"gender\":patient.gender,\"temperature\":updatedFeatures['Temperature'].value,\"heart_rate\":updatedFeatures['Heart Rate'].value,\"resp_rate\":updatedFeatures['Respiration Rate'].value,\"spo2\":updatedFeatures['Oxygen Saturation'].value,\"sbp\":updatedFeatures['Systolic Blood Pressure'].value,\"dbp\":updatedFeatures['Diastolic Blood Pressure'].value,\"mbp\":updatedFeatures['Mean Blood Pressure'].value,\"wbc\":updatedFeatures['White Blood Cell Count'].value,\"hemoglobin\":updatedFeatures['Hemoglobin'].value,\"platelet\":updatedFeatures['Platelet Count'].value,\"bun\":updatedFeatures['Blood Urea Nitrogen'].value,\"cr\":updatedFeatures['Creatinine'].value,\"glu\":updatedFeatures['Glucose'].value,\"Na\":updatedFeatures['Sodium'].value,\"Cl\":updatedFeatures['Chloride'].value,\"K\":updatedFeatures['Potassium'].value,\"Mg\":updatedFeatures['Magnesium'].value,\"Ca\":updatedFeatures['Calcium'].value,\"P\":updatedFeatures['Phosphorus'].value,\"inr\":updatedFeatures['International Normalized Ratio'].value,\"pt\":updatedFeatures['Prothrombin Time'].value,\"ptt\":updatedFeatures['Partial Thromboplastin Time'].value,\"bicarbonate\":updatedFeatures['Bicarbonate'].value,\"aniongap\":updatedFeatures['Anion Gap'].value,\"gcs\":updatedFeatures['Glasgow Coma Scale'].value,\"vent\":updatedFeatures['Ventilation'].value,\"crrt\":updatedFeatures['Continuous Renal Replacement Therapy'].value,\"vaso\":updatedFeatures['Vasoconstrictors'].value,\"seda\":updatedFeatures['Sedatives'].value,\"sofa_score\":updatedFeatures['Sequential Organ Failure Assessment Score'].value,\"ami\":updatedFeatures['Acute Myocardial Infarction'].value,\"ckd\":updatedFeatures['Chronic Kidney Disease'].value,\"copd\":updatedFeatures['Chronic Obstructive Pulmonary Disease'].value,\"hyperte\":updatedFeatures['Hypertension'].value,\"dm\":updatedFeatures['Diabetes Mellitus'].value,\"aki\":updatedFeatures['Acute Kidney Injury'].value,\"stroke\":updatedFeatures['Stroke'].value,\"AISAN\":updatedFeatures['Aisan'].value,\"BLACK\":updatedFeatures['Black'].value,\"HISPANIC\":updatedFeatures['Hispanic'].value,\"OTHER\":updatedFeatures['Other'].value,\"WHITE\":updatedFeatures['White'].value,\"unknown\":updatedFeatures['Unknown'].value,\"CCU\":updatedFeatures['Coronary Care Unit'].value,\"CVICU\":updatedFeatures['Cardiovascular Intensive Care Unit'].value,\"MICU\":updatedFeatures['Mobile Intensive Care Unit'].value,\"MICU/SICU\":updatedFeatures['Mobile/Surgical Intensive Care Unit'].value,\"NICU\":updatedFeatures['Neonatal Intensive Care Unit'].value,\"SICU\":updatedFeatures['Surgical Intensive Care Unit'].value,\"TSICU\":updatedFeatures['Trauma Intensive Care Unit'].value})});const predictionString=await response.json();const prediction=JSON.parse(predictionString);setNewPrediction({'prediction':prediction.prediction,'confidence':prediction.confidence});if(oldPrediction.prediction!==prediction.prediction){togglePredictionChangedModal();}};const titles=Object.keys(humanBodyFeaturesNieuw);let origineleWaarden=[];for(const title in humanBodyFeaturesNieuw){const value=humanBodyFeaturesNieuw[title].value;const type=humanBodyFeaturesNieuw[title].type;origineleWaarden.push([value,type]);}const data=titles.map((title,index)=>({id:index+1,gegevens:title,origineleWaarde:origineleWaarden[index][0],typeInput:origineleWaarden[index][1],nieuweWaarde:updatedFeatures[title].value}));function colorRow(row){if(row.nieuweWaarde===row.origineleWaarde){return\"td-values\";}else{return\"row-color\";}}const handleNextInputField=e=>{getChangedFeatures();setModalFeature(e.target.title);if(e.key!=='Enter'){return;}let targetId=Number(e.target.id);const table=document.querySelector(\"#input-fields-table\");const childrenNodes=table.children;if(targetId===childrenNodes.length){targetId=0;}// Focus on the next item in the input list\nchildrenNodes.item(targetId).children.item(2).firstChild.focus();// Dont toggle the modal if the value hasn't changed\nconst tempTitle=e.target.title;if(humanBodyFeaturesNieuw[tempTitle].value===e.target.value){// Using == instead of === for values that are 0\nreturn;}toggleValueChangedModal();};const getChangedFeatures=()=>{let changedFeatureTitles=[];titles.forEach(title=>{if(humanBodyFeaturesNieuw[title].value!==updatedFeatures[title].value){changedFeatureTitles.push(title);}});return changedFeatureTitles;};const toggleValueChangedModal=()=>{setValueChangedIsOpen(!valueChangedIsOpen);};const togglePredictionChangedModal=()=>{setPredictionChangedIsOpen(!predictionChangedIsOpen);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ChangeValuesModal,{isOpen:valueChangedIsOpen,toggle:toggleValueChangedModal,makePrediction:predictionHandler,feature:modalFeature}),/*#__PURE__*/_jsx(PredictionChangedModal,{isOpen:predictionChangedIsOpen,toggle:togglePredictionChangedModal,newPrediction:translatePrediction(newPrediction.prediction),previousPrediction:translatePrediction(oldPrediction.prediction),newCertaintyScore:newPrediction.confidence,previousCertaintyScore:oldPrediction.confidence,features:getChangedFeatures()}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(CardTitle,{className:\"text-dark text-2rem\",children:\"Pati\\xEBntkenmerken wijzigen\"}),/*#__PURE__*/_jsx(CardSubtitle,{className:\"text-muted text-1rem\",children:\"Verander de pati\\xEBntkenmerken om te zien hoe de voorspelling verandert\"})]}),/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:8,children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Gegevens\"}),/*#__PURE__*/_jsx(\"th\",{className:\"th-align-middle\",children:\"Originele waarde\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Voer nieuwe waarde in\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{id:\"input-fields-table\",children:data.map(row=>/*#__PURE__*/_jsxs(\"tr\",{id:row.id,children:[/*#__PURE__*/_jsx(\"td\",{className:`${colorRow(row)} td-left-align`,children:row.gegevens}),typeof row.origineleWaarde===\"number\"&&row.origineleWaarde.toString().includes(\".\")?/*#__PURE__*/_jsx(\"td\",{className:`${colorRow(row)} td-values`,children:Number.parseFloat(row.origineleWaarde).toFixed(2)}):/*#__PURE__*/_jsx(\"td\",{className:`${colorRow(row)} td-values`,children:row.origineleWaarde}),typeof row.nieuweWaarde===\"number\"&&row.nieuweWaarde.toString().includes(\".\")?/*#__PURE__*/_jsx(\"td\",{className:`${colorRow(row)} td-values`,children:/*#__PURE__*/_jsx(Input,{id:row.id,title:row.gegevens,onKeyDown:handleNextInputField,type:row.typeInput,placeholder:\"Enter \"+row.typeInput,defaultValue:Number.parseFloat(row.nieuweWaarde).toFixed(2),onChange:inputHandler})}):/*#__PURE__*/_jsx(\"td\",{className:`${colorRow(row)} td-values`,children:/*#__PURE__*/_jsx(Input,{id:row.id,title:row.gegevens,onKeyDown:handleNextInputField,type:row.typeInput,placeholder:\"Enter \"+row.typeInput,defaultValue:row.nieuweWaarde,onChange:inputHandler})})]},row.id))})]})}),/*#__PURE__*/_jsxs(Col,{md:4,children:[/*#__PURE__*/_jsx(CardSubtitle,{className:\"CardSubtitle_newPred\",children:\"Nieuwe voorspelling\"}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(\"div\",{className:\"numbers\",children:/*#__PURE__*/_jsx(\"p\",{className:\"card-category text-blue font-weight-bolder\",children:\"Heeft SAD?\"})})}),/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(\"div\",{className:\"numbers text-center\",children:/*#__PURE__*/_jsx(CardTitle,{className:\"font-italic size1-5rem font-weight-bold\",children:translatePrediction(newPrediction.prediction)})})})]}),/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{children:/*#__PURE__*/_jsx(\"div\",{className:\"numbers\",children:/*#__PURE__*/_jsx(CardTitle,{className:\"card-category font-weight-bold\",children:\"Certainty Score\"})})}),/*#__PURE__*/_jsx(CardBody,{children:/*#__PURE__*/_jsx(\"div\",{className:\"numbers text-center\",children:/*#__PURE__*/_jsx(CardTitle,{className:\"font-italic size1-5rem font-weight-bold\",children:newPrediction.confidence})})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-center\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:toggleValueChangedModal,children:\"Nieuwe Voorspelling Opslaan\"})})]})]})})]})]});}export default ModelInput;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}